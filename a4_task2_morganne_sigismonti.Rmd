---
title: "Assignment 4, Task 2"
author: "Morganne Sigismonti"
date: "11/13/2020"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(janitor)
library(here)
library(ggpubr)
library(broom)
library(lubridate)
library(kableExtra)
library(ggbeeswarm)
library(effsize)
```

### 1. Introduction NOT FINISHED

This report is an exploratory overview of the difference in Snowshoe Hare 
A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last.


### 2. Data and Analyses NOT FINISHED

Snowshoe Hare physical data was collected and made available by Dr. Kielland and colleagues at the Bonanza Creek Long Term Ecological Research (LTER) Experimental Forest in Fairbanks, Alaska. The data contain observations for 3,197 individual hares across 5 locales in the Tanana valley from 1999 to 2002 (Kielland et al. (2017)).


A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.

### 3. Preliminary Results

#### A. Annual juvenile hare trap counts

**Table 1.** The total juvenile hare trap counts for each year 1999 through 2012. Data: Kielland et al. (2017).

```{r}
bonanza_clean <- read_csv(here("data", "bonanza_hares.csv")) %>%
   mutate(date = mdy(date))

bonanza_ann_juv <- bonanza_clean %>% 
  mutate(year = year(date)) %>% 
  select(year, grid, age) %>% 
  filter(age == "j") %>% 
  group_by(year) %>% 
  count(year) %>%
  rename("Total Juvenile Hares" = n) %>%
  rename("Year" = year)

kbl(bonanza_ann_juv)%>%
 kable_styling(bootstrap_options = "striped", full_width = FALSE)


```



```{r, include = FALSE}
## The mean and median of the total number of juvenile hares trapped from 1999 through 2012. Data: Kielland et al. (2017).
bonanza_ann_juv_stats <- bonanza_clean %>%
  mutate(year = year(date)) %>% 
  select(year, grid, age) %>% 
  filter(age == "j") %>%
  mutate(age = recode(age, "j" = "Juvenile")) %>%
  group_by(year, age) %>% 
  count(year) %>% 
  group_by("Age" = age) %>% 
 summarize("Mean" = mean(n),
            "Median" = median(n))
  

kbl(bonanza_ann_juv_stats)%>%
 kable_styling(bootstrap_options = "striped", full_width = FALSE)

```
Juvenile Snowshoe Hare trap counts per year are shown in the figure.The minimum and maximum number of juvenile hares counted was 2 hares in 2010 and 126 hares in 1999. The mean and median annual hare trap counts were `r bonanza_ann_juv_stats$Mean` and `r bonanza_ann_juv_stats$Median`. From year 1999 to 2010, there is an overall decrease in the amount of juvenile snowshoe hare samples collected per year. Moving forward, 


## HELP WHAT DOES THIS MEAN?
What would you suggest be done moving forward (you are not expected to actually do this) to standardize the juvenile hare population in future analyses?

### 4. Visualizing Juvenile hare weights

```{r}
bonanza_jweights_viz <- bonanza_clean %>%
  select(age, sex, weight, grid) %>%
  filter(age == "j") %>% 
  group_by(sex, grid) %>%
  mutate(sex = recode(sex, "f" = "Female", "m" = "Male"))

ggplot(data = bonanza_jweights_viz, aes(x = sex, y = weight)) +
  geom_beeswarm(aes(color = sex, fill = sex)) +
    facet_wrap(~ grid) +
  geom_boxplot(fill = NA, width = 0.5, outlier.color = NA) +
  stat_summary(fun=mean, 
               geom="point",
               shape=20, 
               size=4, 
               color="black", 
               fill="black") +
  theme_classic() +
  labs(title = "Juvenile Hare Weights By Sex At Three Sample Sites (SIGISMONTI)",
       x = "\nSex",
       y = "Weight (g)") +
   scale_color_discrete()
 
```


**Figure 2.** Weight (g) for juvenile hares (female, male, and NA (hares with an unknown sex)) across three test locales (bonbs, bonmat, and bonrip). Pink (female), teal(male), and grey (NA) points indicate individual observations for weight (grams) of a juvenile snowshoe hare. Box endpoints indicate the 25^th^ and 75^th^ percentile values; the black line and black point within the box indicate the median and mean value for each sex in each locale, respectively. Data: Kielland et al. (2017)


Distributions of the hare weights do not seem to be normal across the sexes within the 3 locales. Males seem to have a lower average and median weight than females. There is not much of a trend for the NA group weights across sites. There are more data points collected of males and females at the bonrip locale than the other two locales.


### 5. Comparing Juvenile weight comparison (male & female snowshoe hares)
```{r}

bonanza_fmjweights <- bonanza_clean %>%
  filter(age == "j") %>%
  filter(!is.na(weight)) %>%
  filter(!is.na(sex)) %>%
  group_by(sex)
 
 

 bonanza_fmjstats <- bonanza_fmjweights %>%
   mutate(sex = recode(sex, "f" = "Female", "m" = "Male")) %>%
   summarize(
    mean_weights = round(mean(weight),2),
    sd_weights = round(sd(weight),2),
    n = n()
  )
  
  
```


**Table 3.** Descriptive statistics (mean, standard deviation, and sample size) for female and male juvenile snowshoe hares.

```{r}
bonanza_fmjstats %>% 
  kable(col.names = c("Sex", "Mean weight (g)", "Standard deviation (g)", "Sample size")) %>% 
  kable_styling(bootstrap_options = "striped", full_width = FALSE)
```


```{r, include = FALSE}
# Prepping for T-test code:

# plot histograms and qqplots to check assumptions

# Histogram
ggplot(data = bonanza_fmjweights, aes(x = weight)) +
  geom_histogram(bins = 12) +
  facet_wrap(~sex)
# females: relatively normal
# males: possibly some negative skew

# QQ Plot
ggplot(data= bonanza_fmjweights, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~sex)
# females: very linear
# males: relatively linear with outliers at tail ends

# Overall: My assumption that the data is normally distributed holds true. Sample size and therefore Central Limit Theorem (means will be normally distributed). This means that I can use the Two-sample t-test to compare my data!


# T-test code:

# Pull vectors of weights for male & female juvenile hares
m_jhares <- bonanza_fmjweights %>% 
  filter(sex == "m") %>% 
  pull(weight)
  
f_jhares <- bonanza_fmjweights %>% 
  filter(sex == "f") %>% 
  pull(weight)

# Run the t-test:
jhares_ttest <- t.test(m_jhares, f_jhares)

# Get the tidy model results to call outputs in-line: 
jhares_ttest_tidy <- tidy(jhares_ttest)

# Get the means & SDs for each: 
male_mean <- mean(m_jhares)
female_mean <- mean(f_jhares)
male_sd <- sd(m_jhares)
female_sd <- sd(f_jhares)

# Get the effect size: 
jhares_effsize <- cohen.d(m_jhares, f_jhares)

```

On average, male juvenile snowshoe hares have a higher weight than female snowshoe hares (`r round(male_mean, 2)` $\pm$ `r round(male_sd, 2)` and `r round(female_mean, 2)` $\pm$ `r round(female_sd, 2)` g, respectively; mean $\pm$ 1 standard deviation). While the absolute difference in means is `r round(male_mean, 2) - round(female_mean, 2)` g (a `r round(male_mean - female_mean)/((male_mean + female_mean/2)*100)` % difference), the difference in means is significant (Welch's two-sample t-test: t(`r round(jhares_ttest_tidy$parameter, 2)`) = `r round(jhares_ttest_tidy$statistic, 2)`, p < 0.05) and the effect size is small (Cohen's *d* = `r round(jhares_effsize$estimate, 2)`). 


### 6. Relationship between juvenile weight & hind foot length


```{r}

# Get just Juveniles (which I should have done way earlier in the data, but oh well)
juv_hares <- bonanza_clean %>% 
  filter("j" == age)

ggplot(data = juv_hares, aes(x = hindft, y = weight)) +
  ggtitle("Relationship Between Juvenile Hare Hind Foot Length and Weight (SIGISMONTI)") +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "gray30") +
  theme_minimal() +
  labs(x = "\nHind Foot Length (mm)",
       y = "Weight (g)\n") +
  theme(plot.title = element_text(size = 11))



```


```{r}
# Do linear regression
juv_hare_lm <- lm(weight ~ hindft, data = juv_hares)

# Get tidy versions of the model output to call later on in text
juv_lm_tidy <- tidy(juv_hare_lm)
juv_lm_glance <- glance(juv_hare_lm)

# See model diagnostics:
## plot(juv_hare_lm)

# Get Pearson's r correlation
juv_cor <- cor.test(juv_hares$weight, juv_hares$hindft)

# Tidy version of correlation output:
juv_cor_tidy <- tidy(juv_cor)
```

The relationship between juvenile hare weight and hind foot length appears non-linear. Simple linear regression revealed that hare weight does significantly predict hare hind foot length (p < 0.001, R^2^ = `r round(juv_lm_glance$r.squared,2)`) with an average slope of $\beta$ = `r round(juv_lm_tidy$estimate[2], 2)` g mm^-1^ (i.e., for each one millimeter increase in hind foot length we expect an average increase in weight of `r round(juv_lm_tidy$estimate[2], 2)` g). Hind foot length and weight have a medium, and significant, positive correlation (Pearson's *r* = `r round(juv_cor_tidy$estimate,2)`, p < 0.001). Diagnostic plots (not included) reveal not normally distributed and heteroscedastic residuals. 

### WHAT WORRIES ME? which assumptions of linear regression may be a concern? ourliers from cooks? low p value but heteroscedastic? confused here



### Summary

Exploratory data analysis reveals the following initial findings: 

- 
- 
- 

### Citations

Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14